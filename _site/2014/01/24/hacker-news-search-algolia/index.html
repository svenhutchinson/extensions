<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Hacker News search: 6.5 million articles and comments at your fingertips &middot; Hyde
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/extensions/public/css/poole.css">
  <link rel="stylesheet" href="/extensions/public/css/syntax.css">
  <link rel="stylesheet" href="/extensions/public/css/hyde.css">
  <link rel="stylesheet" href="/extensions/public/css/algolia.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/extensions/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/extensions/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-09">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/extensions/">
          Hyde
        </a>
      </h1>
      <p class="lead">The popular <a href="http://hyde.getpoole.com/" target="_blank">Hyde theme</a> for <a href="http://jekyllrb.com" target="_blank">Jekyll</a>, now with instant-search capabilities. Made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a> and <a href="https://www.algolia.com/" target="_blank">Algolia</a></p>
    </div>

    <input type="text" class="algolia__input js-algolia__input" autocomplete="off" name="query" placeholder="Search in this site..." />

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/extensions/">Home</a>

      

      
      
        
          
        
      
        
          
          <a class="sidebar-nav-item" href="/extensions/about/">About</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/svenhutchinson/extensions">GitHub project</a>
      <span class="sidebar-nav-item">Currently v2.1.0</span>
    </nav>

    <p>&copy; 2016. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="algolia__initial-content js-algolia__initial-content"><div class="post">
  <h1 class="post-title">Hacker News search: 6.5 million articles and comments at your fingertips</h1>
  <span class="post-date">24 Jan 2014</span>
  <p>We are <a href="https://news.ycombinator.com">Hacker News</a> readers and probably just
like you, there is not a day that goes by we don’t use it. It is a little like
checking the weather app of the tech world. Long story short, Hacker News is
awesome, and we wanted to add our two cents to make it even greater to use.</p>

<p>Indeed, here is our problem: how do we instantly access the old posts we wish
we had saved?</p>

<h2 id="powering-a-newhacker-news-search-engine">Powering a new Hacker News search engine</h2>

<p>Up until now we’ve been using <a href="http://www.hnsearch.com">hnsearch.com</a>,
maintained for years by the great folks at <a href="http://octopart.com/">Octopart</a>. I
hope we speak on behalf of the HN community here, we are all grateful for the
work they put in hnsearch.com and they inspired us to pursue their effort.</p>

<p>Back in September 2013, we created a “<a href="https://news.ycombinator.com/item?id=6476003">homemade Hacker News
crawler</a>” and built a search
engine with the data we could get. It was not perfect but somehow, it did the
job fine.</p>

<p><a href="http://blog.ycombinator.com/algolia-
yc-w14-launches-a-search-api-that-lets-you-provide-apple-spotlight-like-
realtime-search-for-your-app-or-service">Now part of the Ycombinator W14 batch</a>, we have a direct access to the data
and it has allowed us to provide instant search for the entire content of
Hacker News, 1.2 million articles, 5.2 million comments as of today. See for
yourself right here: <a href="http://hn.algolia.com/">hn.algolia.com</a></p>

<h2 id="here-is-how-we-did-it">Here is how we did it</h2>

<ul>
  <li>
    <h3 id="hacker-news-api-access">Hacker News API access</h3>

    <ul>
      <li>YC provides us a private API access to fetch batches of 1000 items (an item being a comment or a post). Every two minutes, we update our database with the latest 1000 items. Last 48,000 items are refreshed every hour to keep the number of votes and comments up to date.</li>
    </ul>

    <p><code>
# Yep, that's a Lisp API :)
EXPORT_REGEXP = %r{^((d+) (story|comment|poll|pollopt) "(.+)" (d+) (?:nil|"(.*)") (?:nil|"(.+)") (?:nil|"(.*)") (?:nil|-?(d+)) (?:nil|(([d ]+))) (?:nil|(d+)))$}
</code></p>
  </li>
  <li>
    <h3 id="thumbnails-generation">Thumbnails generation</h3>

    <ul>
      <li>We use <a href="https://code.google.com/p/wkhtmltopdf/">wkhtmltoimage</a> to render the URLs and generate the associated thumbnails. Playing with connection timeouts and JavaScript infinite loops was a pleasure:</li>
    </ul>

    <p><code>
(timeout 60 xvfb-run --auto-servernum --server-args="-screen 0, 1024x768x24" 
wkhtmltoimage-amd64 --height 768 --use-xserver--javascript-delay 30000 "$URL" "$FILE" || 
timeout 60 xvfb-run --auto-servernum --server-args="-screen 0, 1024x768x24" 
wkhtmltoimage-amd64 --height 768 --use-xserver --disable-javascript "$URL" "$FILE") &amp;&amp; 
convert "$FILE" -resize '100!x100' "$FILE"
</code></p>
  </li>
  <li>
    <h3 id="thumbnails-storage">Thumbnails storage</h3>

    <ul>
      <li>Thumbnails are resized and stored on a S3 bucket.</li>
    </ul>

    <p><code>
AWS::S3::S3Object.store("#{id}.png", open(temp_file), 'hnsearch', access: :public_read)
</code></p>
  </li>
  <li>
    <h3 id="thumbnails-distribution">Thumbnails distribution</h3>

    <ul>
      <li>We configured a CloudFront instance targeting the S3 bucket to distribute thumbnails with low latency and high data transfer speed. We followed Amazon’s associated <a href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/MigrateS3ToCloudFront.html">developer guide</a>.</li>
    </ul>
  </li>
  <li>
    <h3 id="indexing">Indexing</h3>

    <ul>
      <li>We used the “<a href="https://github.com/algolia/algoliasearch-rails">algoliasearch-rails</a>” gem and a standard (Ruby on Rails) MySQL-backed ActiveRecord setup. Indexing is performed automatically as soon as new items are added to the database, providing a near-realtime experience.</li>
    </ul>
  </li>
  <li>
    <h3 id="configuration">Configuration</h3>

    <p>```ruby
class Item &lt; ActiveRecord::Base
  include AlgoliaSearch</p>

    <p>algoliasearch per_environment: true do
    # the list of attributes sent to Algolia’s API
    attribute :created_at, :title, :url, :author, :points, :story_text, :comment_text, :author, :num_comments, :story_id, :story_title, :story_url
    attribute :created_at_i do
      created_at.to_i
    end</p>

    <pre><code># The order of the attributes sets their respective importance.
# `title` is more important than `{story,comment}_text`, `{story,comment}_text` more than `url`, `url` more than `author`
# btw, do not take into account position to avoid first word match boost
attributesToIndex ['unordered(title)', 'unordered(story_text)', 'unordered(comment_text)', 'unordered(url)', 'author', 'created_at_i']

# add tags used for filtering
tags do
  [item_type, "author_#{author}", "story_#{story_id}"]
end

# Custom ranking allows to automatically sort the results by a custom criteria
# in this case, a decreasing sort of the number of HN points and comments.
customRanking ['desc(points)', 'desc(num_comments)']

# controls the way results are sorted sorting on the following 4 criteria (one after another)
# I removed the 'exact' match critera (improve 1-words query relevance, doesn't fit HNSearch needs)
ranking ['typo', 'proximity', 'attribute', 'custom']

# google+, $1.5M raises, C#: we love you
separatorsToIndex '+#$'   end
</code></pre>

    <p>def story_text
    item_type_cd != Item.comment ? text : nil
  end</p>

    <p>def story_title
    comment? &amp;&amp; story ? story.title : nil
  end</p>

    <p>def story_url
    comment? &amp;&amp; story ? story.url : nil
  end</p>

    <p>def comment_text
    comment? ? text : nil
  end</p>

    <p>def comment?
    item_type_cd == Item.comment
  end</p>

    <p>def num_comments
    item_type_cd == Item.story ? story_comments.count : nil
  end
end
```</p>
  </li>
  <li>
    <h3 id="search">Search</h3>

    <ul>
      <li>Queries are sent directly to our API via the<a href="https://github.com/algolia/algoliasearch-client-js"> javascript client</a>, the javascript code uses a public API-Key that can only perform queries.</li>
    </ul>
  </li>
</ul>

<h2 id="seeking-feedback-from-the-community">Seeking feedback from the community</h2>

<p>There is still room for improvement and we would love to know how you are
searching for news on HN. What is important for you? Are you searching by
date, by upvote, by comment or by user? All together maybe?</p>

<p>We would love to have your feedback! Don’t hesitate to checkout the code: <a href="https://github.com/algolia/hn-search">We
open-sourced it</a>.</p>

<p>Special thanks to the <a href="http://octopart.com/">Octopart</a> and
<a href="http://ycombinator.com/">YC</a> teams for making this experience possible!</p>

<p>Give it a try now: <a href="http://hn.algolia.com">hn.algolia.com</a></p>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/extensions/2015/07/15/new-distributed-search-network-texas/">
            Welcome Texas!
            <small>15 Jul 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/extensions/2015/06/15/when-solid-state-drives-are-not-that-solid/">
            When Solid State Drives are not that solid
            <small>15 Jun 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/extensions/2015/05/28/we-just-raised-our-series-a-whats-next/">
            We just raised our Series A. What's next?
            <small>28 May 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>
</div>

      <div class="algolia__search-content js-algolia__search-content">
        <h1 class="page-title">Search</h1>
        <div class="posts algolia__results"></div>
      </div>
    </div>

  <script>
  window.ALGOLIA_CONFIG = {
    'applicationId': 'MFYV1TCXOX',
    'indexName': 'jekyll_NAME',
    'apiKey': '',
    'baseurl': '/extensions'
  }
</script>
<script id="algolia__template" type="text/template">

  <div class="algolia__result">
    <a class="algolia__result-link" href="{{ full_url }}#algolia:{{ css_selector }}">{{{ _highlightResult.title.value }}}</a>
    {{#posted_at}}
    <div class="algolia__result-date">{{ posted_at_readable }}</div>
    {{/posted_at}}
    <div class="algolia__result-text">{{{ _highlightResult.text.value }}}</div>
  </div>

</script>
<script id="algolia__template--no-results" type="text/template">
  No results found.
</script>
<script src="//cdn.jsdelivr.net/jquery/2.1.4/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/algoliasearch/3.6.0/algoliasearch.min.js"></script>
<script src="//cdn.jsdelivr.net/algoliasearch.helper/2.1.0/algoliasearch.helper.min.js"></script>
<script src="//cdn.jsdelivr.net/hogan.js/3.0.2/hogan.min.js"></script>
<script src="//cdn.jsdelivr.net/momentjs/2.10.3/moment.min.js"></script>
<script src="/extensions/public/js/algolia.js"></script>

  </body>
</html>
